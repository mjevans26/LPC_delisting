---
title: "Remote Sensing Lesser Prairie Chicken"
author: "Defenders of Wildlife"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_document:
    css: custom.css
    df_print: paged
    fig_caption: yes
    fig_width: 7
    highlight: tango
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
data(rus)
#n <- nrow(rus)
library(dplyr)
library(ggplot2)
library(lme4)
library(mclogit)
library(party)
library(plotly)
library(pROC)
library(sensitivity)
library(stringr)
library(tidyr)
```

# Methods

### Data

Oklahoma provides approval dates.  We selected all records approved after Sept. 01, 2015.
Kansas provides year start.  To be conservative, we selected all records starting in 2016 and 2017.
Colorado provides 'spud date.'  We selected all records after Sept. 01, 2015.

New Mexico provides approval, effective, and spud dates.  

Texas provides approved date, and completion date.

The LPC RWP specifies buffer distances around specific forms of habitat disturbance.  We buffered newly constructed turbines and oil and well pads by 667m and 200m, respectively.  Private roads were buffered by 10m.

http://www.kansasenergy.org/wind_projects.htm

If suitable sentinel data was not available before the well date, we compared aerial imagery from before the well date to the suitable sentinel data after the well date.  If no change was detected...

```{r cars}
summary(cars)
```

### Results

We identified 713 turbines constructed between located within LPC habitat.  Buffering each of these by 667m, equates to 129,739 ac subject to mitigation banking.

378 wells were reported, of which 309 could be detected.  We identified well pads within 500m of 188 of these 309 locations.

Kansas reported 163 with 'Year Start' of 2016 or 2017.  All were evaluated, 46 detected.
New Mexico reported 63 with spud date after 09/01/2015 25 evaluated, 23 detected
Texas reported 132 with completion date after 09/01/2015 105 evaluated 49 detected
Colorado reported 1 with 'spud date' afte 09/01/2015 1 evaluated 1 detected
Oklahoma reported 19 16 evaluated 3 detected

Of these, we detected 178 wells within 500m of reported locations.  This equated to 3150 acres of potential mitigation.

These discrepancies may arise for several reasons, inaccurately reported cooridnates, inaccurate dates either signifying well construction occurred later than in reality, or delays in construction.

151 + 28 additional 'pad-like' disturbances were detected at least 500m from reported pads.  This is a potential ~ 4569+1231 acres of mitigation.
## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot_ly(data = new2, x = ~ (NDVI_max)*(count+1)/count, y = ~ NDVI_var, color = ~ Class, type = "scatter", mode = "markers", text = ~paste(feat, count), hoverinfo = text)

plot_ly(data = ndvi_raw[ndvi_raw$Class == 2 & ndvi_raw$NDVI_count > 4,], x = ~(NDVI_max)*(NDVI_count+1)/NDVI_count, type = "histogram")

plot_ly(data = new2, x = ~ (NDVI_max), y = ~ NDVI_disp, color = ~ Class, type = "scatter", mode = "markers", text = ~paste(feat, count), hoverinfo = text)

plot_ly(data = ndvi_raw[ndvi_raw$Class == 1 & ndvi_raw$NDVI_count > 5,], x = ~(NDVI_max), type = "histogram")

hist(ndvi_raw$NDVI_var[ndvi_raw$Class == 2 & ndvi_raw$NDVI_count > 5 & ndvi_raw$feat %in% tier1], freq = FALSE, breaks = 50)

hist(ndvi_raw$NDVI_max[ndvi_raw$Class == 1 & ndvi_raw$NDVI_count > 5], freq = FALSE, breaks = 50)

fit1var <- fitdist(ndvi_raw$NDVI_var[ndvi_raw$Class == 1 & ndvi_raw$NDVI_count > 5], "invgamma", start = list(a=3, b=0.03))

curve(dinvgamma(x, fit1var$estimate[1], fit1var$estimate[2]), from = 0.001, to = 0.05, lwd = 2, add = TRUE)

dist23var <- curve(dinvgamma(x, 2.75, 0.07), from = 0.001, to = 0.2, add = TRUE, lwd = 2)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

dgev <- function(x, loc, scl, shp){
  t <- if(shp != 0){
    (1+(shp*((x-loc)/scl)))^(-1/shp)
    }else{
    exp(-(x-loc)/scl)
    }
  d <- (1/scl)*(t^(shp+1))*exp(-t)
  return(d)
}

pgev <- function(q, loc, scl, shp){
  t <- if(shp != 0){
    (1+(shp*((x-loc)/scl)))^(-1/shp)
    }else{
    exp(-(x-loc)/scl)
    }
  p <- exp(-t)   
}

dinvgamma <- function(x, a, b){
 d <- (b^a)/gamma(a)*(x^(-a-1))*exp(-b/x)
 return(d)
}

pinvgamma <- function(q, a, b){
 p <- pscl::pigamma(q, a, b)
 return(p)
}
